\documentclass[11pt, a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage[french]{babel}
\usepackage[T1]{fontenc}


\begin{document}

\title{Spécification des fonctions du pilote de périphérique}

\newcommand{\kw}[1]{\texttt{#1}}

\newcommand{\DescFonction}[4]{%
	\texttt{\Large{#1}} % insert horizontal rule here
	\textbf{Synospis} \\
	#2 \\
	\textbf{Description} \\
	#3 \\
	\textbf{Valeur de retour} \\
	#4 \\
}

\DescFonction{open}
{int open(const char* filename, int flags, int perms)}
{Ouvre le capteur désigné par \kw{filename}, et renvoie une descripteur de fichier (\emph{file descriptor}), qui l'identifie au sein du programme. \kw{flags} indique le mode d'ouverture, et doit être fixé à \kw{O\_RDONLY}, les capteurs étants en lecture seule. Plusieurs capteurs peuvent être ouvert au sein du même programme. Si un même capteur est ouvert plusieurs fois au sein du même programme, alors plusieurs descripteurs de fichiers seront disponible pour lire sur un même capteur. Si le fichier précisé dans le premier paramêtre (\kw{filename}) n'existe pas, l'appel échoue, et \kw{open} retourne immédiatement, avec la valeur -1.}
{Si l'appel reussi, un descripteur de fichier (entier positif). Sinon, -1.}

\DescFonction{creat}
{int creat(const char *pathname, int mode);}
{Le comportement de cette fonction est similaire à celui de la fonction \kw{open}}
{Les valeurs de retours sont les mêmes que celles de la fonction \kw{open}.}

\DescFonction{close}
{int close(int fd);}
{Ferme le capteur désigné par le descripteur de fichier \kw{fd}. Celui-ci ne sera plus utilisable dans le programme.
Si le paramêtre \kw{fd} est invalide (i.e. négatif ou ne correspondant pas à un descripteur de fichier valide), \kw{close} retourne -1.}
{Si l'appel réussi, 0 est renvoyé, -1 sinon.}

\DescFonction{remove}
{int remove(const char *pathname);}
{Ferme le capteur désigné par \kw{pathname}. Il ne sera plus utilisable au sein du programme.
Si \kw{pathname} est invalide (le fichier n'existe pas, ou n'est pas ouvert au sein du programme), alors l'appel échoue.}
{SI l'appel réussi, 0, -1 sinon.}

\DescFonction{read}
{int read (int fd, char *buffer, size\_t maxbytes);}
{Lit un message d'un capteur désigné par \kw{fd}, et le place dans l'adresse pointé par \kw{buffer}. 
 Si un message est disponible, alors il est placé dans à l'adresse \kw{buffer}, mais n'est pas \emph{consommé}. Plusieurs appels successifs à \kw{read} sur un même file descriptor peuvent donc donner le même message.

Un message lu sur un capteur est du type \kw{capt\_msg}, qui est défini de la manière suivante :
\kw{%
struct capt\_msg
\{
\vspace{1cm} unsigned ID;
\vspace{1cm} timestamp date;
\vpsace{1cm} char msg[TAILLE\_MAX];
\};
}
{Si aucun message n'est disponible (par exemple dès la mise sous tension du capteur, et en attente de ma première information), -1 est renvoyé, sinon, un entier positif, correspondant à la taille lue (\kw{sizeof(capt\_msg)}) est renvoyé.
}



\DescFonction{write}
{int write (int fd, char *buffer, size\_t maxbytes);}
{Appel non supporté, les capteurs sont en lecture seule. Pour faire une opération sur un capteur, utiliser \kw{ioctl}.}
{N.A.}
{N.A.}
	
\DescFonction{ioctl}
{int ioctl(int fd, int request, int value);}
{Configuration du pilote.
Si request est inférieur ou égal à 255, l'adresse du nouveau périphérique branché doit être passé en \kw{value}. Cette partie sera spécifiée ultérieurement.
Les valeurs de request plus élevées sont réservées, et pourront correspondre à d'autres fonctionnalités, dans le future.}
{0 en cas de succès, -1 sinon.}

\end{document}


